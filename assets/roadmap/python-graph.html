<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Python Roadmap Graph</title>

  <!-- D3 CDN -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <style>
    html, body { margin: 0; height: 100%; background: #0b1220; }
    #wrap { position: relative; height: 100%; }
    svg { width: 100%; height: 100%; display: block; }

    .hint {
      position: absolute; left: 12px; top: 12px;
      padding: 8px 10px; border-radius: 10px;
      background: rgba(255,255,255,0.10); color: rgba(255,255,255,0.85);
      font: 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      user-select: none;
    }

    .node circle { cursor: grab; }
    .node text { fill: rgba(255,255,255,0.82); font: 12px system-ui, sans-serif; pointer-events: none; }
    .link { stroke: rgba(255,255,255,0.20); stroke-width: 1.2; }
  </style>
</head>
<body>
<div id="wrap">
  <div class="hint">드래그: 노드 이동 · 휠: 확대/축소 · 클릭: 태그/페이지 이동</div>
  <svg id="svg"></svg>
</div>

<script>
  // -----------------------------
  // 1) 데이터 (여기만 바꾸면 됨)
  // -----------------------------
  const nodes = [
    { id: "Python", url: "/python/" },
    { id: "Basic",  url: "/tags/python-basic/" },
    { id: "OpenCV", url: "/tags/opencv/" },
    { id: "OCR",    url: "/tags/ocr/" },
    { id: "FastAPI",url: "/tags/fastapi/" },
    { id: "PyTorch",url: "/tags/pytorch/" },
  ];

  const links = [
    { source: "Python", target: "Basic" },
    { source: "Python", target: "OpenCV" },
    { source: "Python", target: "OCR" },
    { source: "Python", target: "FastAPI" },
    { source: "Python", target: "PyTorch" },
    { source: "OpenCV", target: "OCR" },
  ];

  // -----------------------------
  // 2) SVG + Zoom
  // -----------------------------
  const svg = d3.select("#svg");
  const width  = svg.node().clientWidth;
  const height = svg.node().clientHeight;

  const g = svg.append("g");

  svg.call(
    d3.zoom()
      .scaleExtent([0.3, 3])
      .on("zoom", (event) => g.attr("transform", event.transform))
  );

  // -----------------------------
  // 3) 링크/노드 그리기
  // -----------------------------
  const link = g.append("g")
    .attr("class", "links")
    .selectAll("line")
    .data(links)
    .join("line")
    .attr("class", "link");

  const node = g.append("g")
    .attr("class", "nodes")
    .selectAll("g")
    .data(nodes)
    .join("g")
    .attr("class", "node")
    .call(
      d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended)
    );

  node.append("circle")
    .attr("r", (d) => d.id === "Python" ? 16 : 10)
    .attr("fill", (d) => d.id === "Python" ? "rgba(255,255,255,0.75)" : "rgba(255,255,255,0.55)")
    .on("click", (event, d) => {
      // iframe 안에서 클릭하면 "부모 페이지"를 이동시키기 (권장)
      // GitHub Pages/동일 도메인이면 정상 동작
      if (d.url) window.top.location.href = d.url;
    });

  node.append("text")
    .attr("x", 14)
    .attr("y", 4)
    .text((d) => d.id);

  // -----------------------------
  // 4) Force Simulation
  // -----------------------------
  const simulation = d3.forceSimulation(nodes)
    .force("link", d3.forceLink(links).id(d => d.id).distance(120))
    .force("charge", d3.forceManyBody().strength(-500))
    .force("center", d3.forceCenter(width / 2, height / 2))
    .force("collision", d3.forceCollide().radius(22))
    .on("tick", ticked);

  function ticked() {
    link
      .attr("x1", d => d.source.x)
      .attr("y1", d => d.source.y)
      .attr("x2", d => d.target.x)
      .attr("y2", d => d.target.y);

    node.attr("transform", d => `translate(${d.x},${d.y})`);
  }

  function dragstarted(event, d) {
    if (!event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x; d.fy = d.y;
  }
  function dragged(event, d) {
    d.fx = event.x; d.fy = event.y;
  }
  function dragended(event, d) {
    if (!event.active) simulation.alphaTarget(0);
    d.fx = null; d.fy = null;
  }

  // 리사이즈 대응(간단 버전)
  window.addEventListener("resize", () => window.location.reload());
</script>
</body>
</html>
